@model IEnumerable<Lustrious.Models.Produto>
@{
 ViewData["Title"] = "Vitrine";
 int currentPage = ViewBag.CurrentPage ??1;
 int totalPages = ViewBag.TotalPages ??1;
 string filterQ = ViewBag.FilterQ as string ?? string.Empty;
 int filterCategoria = ViewBag.FilterCategoria ??0;
 int filterTipo = ViewBag.FilterTipo ??0;
 var categorias = ViewBag.Categorias as IEnumerable<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem> ?? Enumerable.Empty<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>();
 var tipos = ViewBag.Tipos as IEnumerable<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem> ?? Enumerable.Empty<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>();
}


<h2>Vitrine</h2>
<form method="get" asp-action="Vitrine" class="filters">
 <input type="text" name="q" value="@filterQ" placeholder="Pesquisar..." />
 <select name="codCategoria" id="categoriaFilter">
 <option value="0">Todas Categorias</option>
 @foreach(var c in categorias){
 if(filterCategoria.ToString() == c.Value){
 <option value="@c.Value" selected="selected">@c.Text</option>
 } else {
 <option value="@c.Value">@c.Text</option>
 }
 }
 </select>
 <select name="codTipoProduto" id="tipoFilter">
 <option value="0">Todos Tipos</option>
 @foreach(var t in tipos){
 if(filterTipo.ToString() == t.Value){
 <option value="@t.Value" selected="selected">@t.Text</option>
 } else {
 <option value="@t.Value">@t.Text</option>
 }
 }
 </select>
 <button type="submit" class="btn">Filtrar</button>
</form>

<div class="vitrine">
 @foreach(var p in Model){
 <div class="card">
 @{ var imgSrc = string.IsNullOrEmpty(p.Foto) ? Url.Content("~/imagens/capa_foto.png") : Url.Content("~/" + p.Foto.TrimStart('/','\\')); }
 <img src="@imgSrc" alt="@p.NomeProd" onerror="this.onerror=null;this.src='@Url.Content("~/imagens/capa_foto.png")'" />
 <div class="nome">@p.NomeProd</div>
 <div>@p.NomeCategoria - @p.NomeTipoProduto</div>
 <div class="valor">@p.ValorUnitario.ToString("C")</div>
 <div class="acoes">
 <a asp-action="AcharProduto" asp-controller="Produto" asp-route-id="@p.CodigoBarras" class="btn btn-det">Detalhes</a>
 <form class="ajax-add-to-cart" asp-controller="Carrinho" asp-action="AdicionarItem" method="post">
 @Html.AntiForgeryToken()
 <input type="hidden" name="produtoId" value="@p.CodigoBarras" />
 <button type="submit" class="btn btn-cart" @(p.Qtd <=0 ? "disabled" : "")>@(p.Qtd <=0 ? "Sem estoque" : "Adicionar ao Carrinho")</button>
 </form>
 </div>
 </div>
 }
</div>

<div style="text-align:center; margin-top:18px">
 @if (totalPages >1){
 if (currentPage >1){ <a asp-action="Vitrine" asp-route-page="@(currentPage-1)" asp-route-q="@filterQ" asp-route-codCategoria="@filterCategoria" asp-route-codTipoProduto="@filterTipo">&laquo; Anterior</a> }
 for(int i=1;i<=totalPages;i++){
 if (i==currentPage){ <span style="padding:6px10px; background:#d6b36a; color:#fff; border-radius:6px; margin:4px">@i</span> }
 else{ <a asp-action="Vitrine" asp-route-page="@i" asp-route-q="@filterQ" asp-route-codCategoria="@filterCategoria" asp-route-codTipoProduto="@filterTipo" style="margin:4px; padding:6px10px; background:#f0f0f0; border-radius:6px; text-decoration:none; color:#333">@i</a> }
 }
 if (currentPage < totalPages){ <a asp-action="Vitrine" asp-route-page="@(currentPage+1)" asp-route-q="@filterQ" asp-route-codCategoria="@filterCategoria" asp-route-codTipoProduto="@filterTipo">Próximo &raquo;</a> }
 }
</div>

 <style>

    /* FUNDO GERAL DA PÁGINA */
    body {
        background-color: #c8b68a; /* bege do fundo */
        margin: 0;
        font-family: Arial, sans-serif;
    }

    /* TÍTULO */
    h2 {
        text-align: center;
        color: #4b4b4b;
        margin-top: 25px;
        margin-bottom: 10px;
    }

    /* CONTAINER DA VITRINE */
    .vitrine {
        width: 90%;
        max-width: 1150px;
        margin: 30px auto;
        padding: 25px;
        background-color: #cfc7b4; /* igual à caixinha da imagem */
        border: 6px solid #95845c; /* borda marrom escura */
        border-radius: 20px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 20px;
    }

    /* FILTROS */
    .filters {
        width: 90%;
        max-width: 1150px;
        margin: 0 auto 25px auto;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

        .filters input,
        .filters select {
            padding: 10px;
            border: 2px solid #95845c;
            background: #f5f5f5;
            border-radius: 6px;
        }

        .filters .btn {
            padding: 10px 16px;
            border: none;
            background-color: #3c6b2a; /* verde da imagem */
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s;
        }

            .filters .btn:hover {
                background-color: #4da73b;
            }

    /* CARD DO PRODUTO */
    .card {
        background-color: #e8e2d4; /* fundo suave */
        border: 3px solid #95845c;
        border-radius: 14px;
        padding: 12px;
        text-align: center;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

        .card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 10px;
        }

        /* TEXTO DO PRODUTO */
        .card .nome {
            font-weight: bold;
            color: #4b4b4b;
        }

    .valor {
        font-size: 18px;
        font-weight: bold;
        color: #3c6b2a;
    }

    /* AÇÕES DENTRO DO CARD */
    .acoes {
        margin-top: auto;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    /* BOTÃO DETALHES (marrom suave) */
    .btn-det {
        background-color: #6b5530;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        text-decoration: none;
        transition: 0.2s;
    }

        .btn-det:hover {
            background-color: #8a6d3f;
        }

    /* BOTÃO CARRINHO (verde) */
    .btn-cart {
        background-color: #3c6b2a;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        transition: 0.2s;
    }

        .btn-cart:hover:not(:disabled) {
            background-color: #4da73b;
        }

        .btn-cart:disabled {
            background-color: #8b8b8b;
            cursor: not-allowed;
        }

    /* PAGINAÇÃO */
    .pagination a,
    .pagination span {
        display: inline-block;
        padding: 8px 12px;
        margin: 4px;
        border-radius: 6px;
    }

    .pagination a {
        background-color: #6b5530;
        color: white;
        text-decoration: none;
        transition: 0.2s;
    }

        .pagination a:hover {
            background-color: #8a6d3f;
        }

    .pagination .current {
        background-color: #3c6b2a;
        color: white;
    }

 
 </style>