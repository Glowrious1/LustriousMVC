@model IEnumerable<Lustrious.Models.Produto>
@{
 ViewData["Title"] = "Vitrine";
 int currentPage = ViewBag.CurrentPage ??1;
 int totalPages = ViewBag.TotalPages ??1;
 string filterQ = ViewBag.FilterQ as string ?? string.Empty;
 int filterCategoria = ViewBag.FilterCategoria ??0;
 int filterTipo = ViewBag.FilterTipo ??0;
 var categorias = ViewBag.Categorias as IEnumerable<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem> ?? Enumerable.Empty<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>();
 var tipos = ViewBag.Tipos as IEnumerable<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem> ?? Enumerable.Empty<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>();
}

<style>
 .vitrine { width:95%; margin:20px auto; display:grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap:18px; }
 .card { background:#fff; border-radius:8px; padding:12px; box-shadow:02px6px rgba(0,0,0,0.08); display:flex; flex-direction:column; gap:8px; }
 .card img { width:100%; height:160px; object-fit:cover; border-radius:6px; }
 .card .nome { font-weight:700; font-size:16px; }
 .card .valor { color:#b66f2e; font-weight:700; }
 .card .acoes { margin-top:auto; display:flex; gap:8px; justify-content:space-between; align-items:center; }
 .btn { padding:8px12px; border-radius:6px; border:none; cursor:pointer; }
 .btn-cart { background:#0069d9; color:#fff; }
 .btn-det { background:#c9a55b; color:#fff; }
 .filters { display:flex; gap:8px; margin:12px018px; }
</style>

<h2>Vitrine</h2>
<form method="get" asp-action="Vitrine" class="filters">
 <input type="text" name="q" value="@filterQ" placeholder="Pesquisar..." />
 <select name="codCategoria" id="categoriaFilter">
 <option value="0">Todas Categorias</option>
 @foreach(var c in categorias){
 if(filterCategoria.ToString() == c.Value){
 <option value="@c.Value" selected="selected">@c.Text</option>
 } else {
 <option value="@c.Value">@c.Text</option>
 }
 }
 </select>
 <select name="codTipoProduto" id="tipoFilter">
 <option value="0">Todos Tipos</option>
 @foreach(var t in tipos){
 if(filterTipo.ToString() == t.Value){
 <option value="@t.Value" selected="selected">@t.Text</option>
 } else {
 <option value="@t.Value">@t.Text</option>
 }
 }
 </select>
 <button type="submit" class="btn">Filtrar</button>
</form>

<div class="vitrine">
 @foreach(var p in Model){
 <div class="card">
 @{ var imgSrc = string.IsNullOrEmpty(p.Foto) ? Url.Content("~/imagens/capa_foto.png") : Url.Content("~/" + p.Foto.TrimStart('/','\\')); }
 <img src="@imgSrc" alt="@p.NomeProd" onerror="this.onerror=null;this.src='@Url.Content("~/imagens/capa_foto.png")'" />
 <div class="nome">@p.NomeProd</div>
 <div>@p.NomeCategoria - @p.NomeTipoProduto</div>
 <div class="valor">@p.ValorUnitario.ToString("C")</div>
 <div class="acoes">
 <a asp-action="AcharProduto" asp-controller="Produto" asp-route-id="@p.CodigoBarras" class="btn btn-det">Detalhes</a>
 <form class="ajax-add-to-cart" asp-controller="Carrinho" asp-action="AdicionarItem" method="post">
 @Html.AntiForgeryToken()
 <input type="hidden" name="produtoId" value="@p.CodigoBarras" />
 <button type="submit" class="btn btn-cart" @(p.Qtd <=0 ? "disabled" : "")>@(p.Qtd <=0 ? "Sem estoque" : "Adicionar ao Carrinho")</button>
 </form>
 </div>
 </div>
 }
</div>

<div style="text-align:center; margin-top:18px">
 @if (totalPages >1){
 if (currentPage >1){ <a asp-action="Vitrine" asp-route-page="@(currentPage-1)" asp-route-q="@filterQ" asp-route-codCategoria="@filterCategoria" asp-route-codTipoProduto="@filterTipo">&laquo; Anterior</a> }
 for(int i=1;i<=totalPages;i++){
 if (i==currentPage){ <span style="padding:6px10px; background:#d6b36a; color:#fff; border-radius:6px; margin:4px">@i</span> }
 else{ <a asp-action="Vitrine" asp-route-page="@i" asp-route-q="@filterQ" asp-route-codCategoria="@filterCategoria" asp-route-codTipoProduto="@filterTipo" style="margin:4px; padding:6px10px; background:#f0f0f0; border-radius:6px; text-decoration:none; color:#333">@i</a> }
 }
 if (currentPage < totalPages){ <a asp-action="Vitrine" asp-route-page="@(currentPage+1)" asp-route-q="@filterQ" asp-route-codCategoria="@filterCategoria" asp-route-codTipoProduto="@filterTipo">Próximo &raquo;</a> }
 }
</div>